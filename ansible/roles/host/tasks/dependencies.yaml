- name: "Checkout libvirt"
  ansible.builtin.git:
    repo: 'https://github.com/libvirt/libvirt.git'
    dest: "{{ project_sources_dir }}/libvirt"
    recursive: yes
    version: v8.8.0 # Oct 3, 2022
    depth: 1
    update: no

- name: "Checkout spdk"
  ansible.builtin.git:
    repo: 'https://github.com/spdk/spdk.git'
    dest: "{{ project_sources_dir }}/spdk"
    recursive: yes
    version: v22.09 # Sep 30, 2022
    depth: 1
    update: no

- name: "Checkout oracle-qemu"
  ansible.builtin.git:
    repo: 'https://github.com/oracle/qemu.git'
    dest: "{{ project_sources_dir }}/qemu-orcl"
    recursive: yes
    version: 46bb039c31e92ae84cf7fe1f64119c1a78e0d101 # Jun 3, 2022
    depth: 1
    update: no

#- name: "Configure oracle-qemu to run as multiprocess"
#  register: spdk_reconfigured
#  ansible.builtin.command:
#    cmd: ./configure --with-fio={{ fio_source_dir }}
#    creates: "{{ spdk_source_dir }}/test/common/build_config.sh"
#    chdir: "{{ spdk_source_dir }}"

#- name: "Make spdk"
#  when: spdk_reconfigured.changed
#  ansible.builtin.command:
#    cmd: make
#    chdir: "{{ spdk_source_dir }}"
